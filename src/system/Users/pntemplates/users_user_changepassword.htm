{* $Id$ *}
{gt text='Password changer' assign='templatetitle'}
{include file='users_user_menu.htm'}

<p class="z-informationmsg">{gt text="To change your password, please enter your current password, and then enter a new password (you must enter it twice identically, to ensure that you have entered it correctly)."}</p>

<form id="changepassword" class="z-form" action="{modurl modname="Users" type="user" func="updatepassword"}" method="post">
    <fieldset>
        <legend>{gt text="Change password"}</legend>
        <div class="z-formrow">
            <label for="oldpassword">{gt text="Current password"}</label>
            <input type="password" id="oldpassword" name="oldpassword" value="" />
        </div>
        <div class="z-formrow">
            <label for="newpassword">{gt text="New password"}</label>
            {if $use_password_strength_meter eq 1}
<!--[pnpageaddvar name='javascript' value='system/Users/pnjavascript/passwordStrengthMeter/jquery.js']-->
<!--[pnpageaddvar name='javascript' value='system/Users/pnjavascript/passwordStrengthMeter/passwordStrengthMeter.js']-->

<input name="usernamehidden" id="usernamehidden" value="{user}" type="hidden" />

<script type="text/javascript">

    var shortPass = '{{gt text="Too Short Password"}}';
    var badPass = '{{gt text="Weak; Use letters & numbers"}}';
    var goodPass = '{{gt text="Medium; Use special characters"}}';
    var strongPass = '{{gt text="Strong Password"}}';
    var sameAsUsername = '{{gt text="Password can not match the username, choose a different password."}}';


    jQuery(document).ready(function() {

        var bpos = "";
        var perc = 0 ;
        var minperc = 0 ;
        $('#newpassword').css( {backgroundPosition: "0 0"} );

        $('#newpassword').keyup(function(){
            $('#result').html('&nbsp;&nbsp;'+passwordStrength($('#newpassword').val(),$('#usernamehidden').val())) ;
            perc = passwordStrengthPercent($('#newpassword').val(),$('#usernamehidden').val());

            bpos=" $('#colorbar').css( {backgroundPosition: \"0px -" ;
            bpos = bpos + perc + "px";
            bpos = bpos + "\" } );";
            bpos=bpos +" $('#colorbar').css( {width: \"" ;
            bpos = bpos + (perc * 2) + "px";
            bpos = bpos + "\" } );";
            eval(bpos);
            $('#percent').html(" " + perc  + "% ");
        })
    })
</script>

    <input name="newpassword" id="newpassword" type="password"/>
    <div id="colorbar" class="z-formnote"></div>
        <span id="percent" class="z-formnote">0%</span><span id="result">&nbsp;&nbsp;{gt text='Enter your new password'}</span>
        {else}
            <input type="password" id="newpassword" name="newpassword" value="" />
            {/if}
        </div>
        <div class="z-formrow">
            <label for="newpasswordconfirm">{gt text="New password (repeat for verification)"}</label>
            <input type="password" id="newpasswordconfirm" name="newpasswordconfirm" value="" />
        </div>
    </fieldset>
    <div class="z-formbuttons">
        {button src=button_ok.gif set=icons/small __alt="Save" __title="Save"}
        <a href="{modurl modname=Users type=user func=main}">{img modname=core src=button_cancel.gif set=icons/small __alt="Cancel" __title="Cancel"}</a>
    </div>
</form>
